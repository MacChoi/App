{"version":3,"file":"wavebell.js","sources":["../lib/util/emitter.js","../lib/util/assert.js","../lib/media/audio_filter.js","../lib/media/volume_meter.js","../lib/util/props.js","../lib/media/user_media.js","../lib/media/recorder.js","../lib/wavebell.js"],"sourcesContent":["/*\n * Copyright (C) 2017, Skyler.\n * Use of this source code is governed by the MIT license that can be\n * found in the LICENSE file.\n */\n\nfunction slice (args, from) {\n  return Array.prototype.slice.call(args, from)\n}\n\nclass Emitter {\n  constructor () {\n    this.handlerMap = {}\n  }\n\n  on (event, handler) {\n    if (typeof event !== 'string') {\n      throw new TypeError(event + ' is not a string')\n    }\n    if (typeof handler !== 'function') {\n      throw new TypeError(handler + ' is not a function')\n    }\n    let map = this.handlerMap\n    let handlers = map[event] = map[event] || []\n    let i = handlers.indexOf(handler)\n    if (i === -1) {\n      handlers.push(handler)\n    }\n    return this\n  }\n\n  off (event, handler) {\n    if (handler === undefined) {\n      // remove all handlers\n      delete this.handlerMap[event]\n      return this\n    }\n    // remove registered handler\n    let handlers = this.handlerMap[event]\n    if (handlers) {\n      let i = handlers.indexOf(handler)\n      if (i >= 0) {\n        handlers.splice(i, 1)\n      }\n      // cleanup empty handlers\n      if (handlers.length === 0) {\n        this.off(event)\n      }\n    }\n    return this\n  }\n\n  emit (event) {\n    let args = slice(arguments, 1)\n    let handlers = this.handlerMap[event]\n    if (handlers) {\n      for (let i = 0, len = handlers.length; i < len; i++) {\n        handlers[i].apply(undefined, args)\n      }\n    }\n    return this\n  }\n}\n\nexport default Emitter\n","/*\n * Copyright (C) 2017, Skyler.\n * Use of this source code is governed by the MIT license that can be\n * found in the LICENSE file.\n */\n\nclass Assertion {\n  constructor (value) {\n    this.value = value\n    this._negative = false\n    this._error = new Error('Assertion failed')\n  }\n\n  get to () {\n    return this\n  }\n\n  get not () {\n    this._negative = !this._negative\n    return this\n  }\n\n  that (error) {\n    this._error = error\n    return this\n  }\n\n  equal (value) {\n    if ((value === this.value) === this._negative) {\n      throw this._error\n    }\n  }\n}\n\nfunction assert (value) {\n  return new Assertion(value)\n}\n\nexport default assert\n","/*\n * Copyright (C) 2017, Skyler.\n * Use of this source code is governed by the MIT license that can be\n * found in the LICENSE file.\n */\n\nconst AudioContext = window.AudioContext || window.webkitAudioContext\n\n// AudioContext singleton shared by filters\nlet audioContext = null\n\nclass AudioFilter {\n  /**\n   * Get AudioContext instance\n   * @returns {AudioContext} - Shared instance\n   */\n  get context () {\n    if (!audioContext) {\n      audioContext = new AudioContext()\n    }\n    return audioContext\n  }\n}\n\nexport default AudioFilter\n","/*\n * Copyright (C) 2017, Skyler.\n * Use of this source code is governed by the MIT license that can be\n * found in the LICENSE file.\n */\n\nimport AudioFilter from './audio_filter'\n\nclass VolumeMeter extends AudioFilter {\n  constructor (mainbus, options) {\n    super()\n    this.mainbus = mainbus\n    this.options = Object.assign({\n      minLimit: 0,\n      maxLimit: 128,\n      fftSize: 1024,\n      smoothing: 0.3\n    }, options)\n    this._checkOptions(this.options)\n    this._cache = null\n    this.source = null\n    this.analyser = this._initAnalyser(this.options)\n  }\n\n  _checkOptions (options) {\n    if (options.maxLimit <= options.minLimit) {\n      throw new RangeError('Wrong limit range for volume')\n    }\n  }\n\n  _initAnalyser (options) {\n    // init analyser from options\n    /// ref: https://developer.mozilla.org/en-US/docs/Web/API/AnalyserNode\n    let analyser = this.context.createAnalyser()\n    analyser.fftSize = options.fftSize\n    analyser.smoothingTimeConstant = options.smoothing\n    // process data when available\n    this.mainbus.on('dataavailable', e => this._processData())\n    return analyser\n  }\n\n  pipe (stream) {\n    // connect stream pipe\n    this.source = this.context.createMediaStreamSource(stream)\n    this.source.connect(this.analyser)\n  }\n\n  cutoff () {\n    this.source.disconnect(this.analyser)\n    this.source = null\n  }\n\n  _processData () {\n    // half of the fftSize\n    if (!this._cache) {\n      this._cache = new Uint8Array(this.analyser.frequencyBinCount)\n    }\n    this.analyser.getByteFrequencyData(this._cache)\n    let volume = this._calcAvgVolume(this._cache)\n    this.mainbus.emit('wave', {\n      value: this._alignVolume(volume)\n    })\n  }\n\n  _alignVolume (volume) {\n    let opts = this.options\n    if (volume < opts.minLimit) {\n      volume = opts.minLimit\n    }\n    if (volume > opts.maxLimit) {\n      volume = opts.maxLimit\n    }\n    return (volume - opts.minLimit) / (opts.maxLimit - opts.minLimit)\n  }\n\n  _calcAvgVolume (data) {\n    let sum = 0\n    let len = data.length\n    for (let i = 0; i < len; i++) {\n      sum += data[i]\n    }\n    return sum / len\n  }\n}\n\nexport default VolumeMeter\n","/*\n * Copyright (C) 2017, Skyler.\n * Use of this source code is governed by the MIT license that can be\n * found in the LICENSE file.\n */\n\nconst hasOwn = Object.prototype.hasOwnProperty\n\nclass PropPath {\n  constructor (path) {\n    this.steps = path.split('.')\n    this.fallback = undefined\n  }\n\n  travel (target, fn) {\n    if (typeof fn !== 'function') {\n      throw new TypeError(fn + ' is not a function')\n    }\n    let len = this.steps.length\n    let i = 0\n    let step = this.steps[i]\n    while (fn(target, step) && i < len) {\n      target = target[step]\n      step = this.steps[++i]\n    }\n    return {\n      step: i,\n      value: target\n    }\n  }\n\n  or (defaultValue) {\n    this.fallback = defaultValue\n    return this\n  }\n\n  from (obj) {\n    let ret = this.travel(obj, (target, step) => {\n      return target != null && step in Object(target)\n    })\n    if (ret.step === this.steps.length) {\n      return ret.value\n    } else {\n      return this.fallback\n    }\n  }\n\n  hadBy (obj) {\n    let ret = this.travel(obj, (target, step) => {\n      return target != null && step in Object(target)\n    })\n    return ret.step === this.steps.length\n  }\n\n  ownedBy (obj) {\n    let ret = this.travel(obj, (target, step) => {\n      return target != null && hasOwn.call(target, step)\n    })\n    return ret.step === this.steps.length\n  }\n}\n\nfunction props (path) {\n  if (typeof path !== 'string') {\n    throw new TypeError(path + ' is not a string')\n  }\n  return new PropPath(path)\n}\n\nexport default props\n","/*\n * Copyright (C) 2017, Skyler.\n * Use of this source code is governed by the MIT license that can be\n * found in the LICENSE file.\n */\n\nimport props from '@/util/props'\n\n/**\n * Shim for MediaDevices#getUserMedia method\n * @param {object} constraints - The user media constraints\n */\nfunction getUserMedia (constraints) {\n  if (props('navigator.mediaDevices.getUserMedia').hadBy(window)) {\n    let medias = props('navigator.mediaDevices').from(window)\n    return medias.getUserMedia(constraints)\n  }\n  let userMediaGetter = navigator.getUserMedia ||\n                        navigator.webkitGetUserMedia ||\n                        navigator.mozGetUserMedia ||\n                        navigator.msGetUserMedia\n  if (!userMediaGetter) {\n    throw new Error('getUserMedia is not supported by this browser')\n  }\n  return new Promise((resolve, reject) => {\n    userMediaGetter(constraints, resolve, reject)\n  })\n}\n\n/**\n * Access audio input from microphone device\n */\nfunction getUserMicrophone () {\n  return getUserMedia({ audio: true, video: false })\n}\n\nexport {\n  getUserMedia,\n  getUserMicrophone\n}\n","/*\n * Copyright (C) 2017, Skyler.\n * Use of this source code is governed by the MIT license that can be\n * found in the LICENSE file.\n */\n\nimport Emitter from '@/util/emitter'\nimport assert from '@/util/assert'\nimport VolumeMeter from './volume_meter'\nimport { getUserMicrophone } from './user_media'\n\nfunction buildError (callee, that) {\n  return new Error(`Failed to execute '${callee}' on 'Recorder'` +\n    (that ? `:\\nThe Recorder's state is '${that.state}'.` : ''))\n}\n\nclass Recorder extends Emitter {\n  constructor (options) {\n    super()\n    this.options = Object.assign({\n      mimeType: 'audio/webm',\n      audioBitsPerSecond: 96000\n    }, options)\n    this._intern = null\n    this._result = null\n    this._filter = new VolumeMeter(this, this.options.meter)\n  }\n\n  get state () {\n    if (this._intern === null) {\n      return 'inactive'\n    } else {\n      return this._intern.state\n    }\n  }\n\n  get ready () {\n    return this._intern !== null\n  }\n\n  get result () {\n    if (!this._result) {\n      return null\n    }\n    return new Blob(this._result, {\n      type: this.options.mimeType\n    })\n  }\n\n  open () {\n    assert(this.ready).that(buildError('open')).to.equal(false)\n    return getUserMicrophone().then(stream => {\n      // create internal recorder\n      this._intern = new MediaRecorder(stream, this.options)\n      // register event listeners\n      let eventTypes = ['error', 'pause', 'resume', 'start', 'stop']\n      eventTypes.map(type => {\n        this._intern.addEventListener(type, e => this.emit(type, e))\n      })\n      this._intern.addEventListener('dataavailable', e => {\n        this._result.push(e.data)\n        this.emit('dataavailable', e)\n      })\n      // pipe stream to filter\n      this._filter.pipe(stream)\n    })\n  }\n\n  close () {\n    assert(this.ready).that(buildError('close')).to.equal(true)\n    // close all stream tracks\n    let tracks = this._intern.stream.getTracks()\n    for (let i = 0; i < tracks.length; i++) {\n      tracks[i].stop()\n    }\n    // close stream filter\n    this._filter.cutoff()\n    this._intern = null\n  }\n\n  start (timeslice) {\n    assert(this.state).that(buildError('start', this)).to.equal('inactive')\n    // init result data on every start\n    this._result = []\n    // use lazy open policy\n    if (!this.ready) {\n      this.open().then(() => {\n        this._intern.start(timeslice)\n      })\n    } else {\n      this._intern.start(timeslice)\n    }\n  }\n\n  stop () {\n    assert(this.state).that(buildError('stop', this)).to.not.equal('inactive')\n    this._intern.stop()\n  }\n\n  pause () {\n    assert(this.state).that(buildError('pause', this)).to.equal('recording')\n    this._intern.pause()\n  }\n\n  resume () {\n    assert(this.state).that(buildError('resume', this)).to.equal('paused')\n    this._intern.resume()\n  }\n}\n\nexport default Recorder\n","/*\n * Copyright (C) 2017, Skyler.\n * Use of this source code is governed by the MIT license that can be\n * found in the LICENSE file.\n */\n\nimport Recorder from '@/media/recorder'\n\nclass WaveBell extends Recorder {}\n\nexport default WaveBell\n"],"names":["slice","args","from","Array","prototype","call","Emitter","handlerMap","event","handler","TypeError","map","handlers","i","indexOf","push","undefined","splice","length","off","arguments","len","apply","Assertion","value","_negative","_error","Error","error","assert","AudioContext","window","webkitAudioContext","audioContext","AudioFilter","VolumeMeter","mainbus","options","Object","assign","_checkOptions","_cache","source","analyser","_initAnalyser","maxLimit","minLimit","RangeError","context","createAnalyser","fftSize","smoothingTimeConstant","smoothing","on","_processData","stream","createMediaStreamSource","connect","disconnect","Uint8Array","frequencyBinCount","getByteFrequencyData","volume","_calcAvgVolume","emit","_alignVolume","opts","data","sum","hasOwn","hasOwnProperty","PropPath","path","steps","split","fallback","target","fn","step","defaultValue","obj","ret","travel","props","getUserMedia","constraints","hadBy","medias","userMediaGetter","navigator","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","Promise","resolve","reject","getUserMicrophone","audio","video","buildError","callee","that","state","Recorder","_intern","_result","_filter","meter","ready","to","equal","then","MediaRecorder","eventTypes","addEventListener","type","e","pipe","tracks","getTracks","stop","cutoff","timeslice","open","start","not","pause","resume","Blob","mimeType","WaveBell"],"mappings":"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"}