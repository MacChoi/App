!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.WaveBell=e()}(this,function(){"use strict";function t(t){return new c(t)}function e(t){if("string"!=typeof t)throw new TypeError(t+" is not a string");return new v(t)}function n(){return function(t){if(e("navigator.mediaDevices.getUserMedia").hadBy(window))return e("navigator.mediaDevices").from(window).getUserMedia(t);var n=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;if(!n)throw new Error("getUserMedia is not supported by this browser");return new Promise(function(e,i){n(t,e,i)})}({audio:!0,video:!1})}function i(t,e){return new Error("Failed to execute '"+t+"' on 'Recorder'"+(e?":\nThe Recorder's state is '"+e.state+"'.":""))}var r=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},u=function(){function t(){r(this,t),this.handlerMap={}}return o(t,[{key:"on",value:function(t,e){if("string"!=typeof t)throw new TypeError(t+" is not a string");if("function"!=typeof e)throw new TypeError(e+" is not a function");var n=this.handlerMap,i=n[t]=n[t]||[];return-1===i.indexOf(e)&&i.push(e),this}},{key:"off",value:function(t,e){if(void 0===e)return delete this.handlerMap[t],this;var n=this.handlerMap[t];if(n){var i=n.indexOf(e);i>=0&&n.splice(i,1),0===n.length&&this.off(t)}return this}},{key:"emit",value:function(t){var e=function(t,e){return Array.prototype.slice.call(t,e)}(arguments,1),n=this.handlerMap[t];if(n)for(var i=0,r=n.length;i<r;i++)n[i].apply(void 0,e);return this}}]),t}(),c=function(){function t(e){r(this,t),this.value=e,this._negative=!1,this._error=new Error("Assertion failed")}return o(t,[{key:"that",value:function(t){return this._error=t,this}},{key:"equal",value:function(t){if(t===this.value===this._negative)throw this._error}},{key:"to",get:function(){return this}},{key:"not",get:function(){return this._negative=!this._negative,this}}]),t}(),l=window.AudioContext||window.webkitAudioContext,h=null,f=function(){function t(){r(this,t)}return o(t,[{key:"context",get:function(){return h||(h=new l),h}}]),t}(),p=function(t){function e(t,n){r(this,e);var i=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.mainbus=t,i.options=Object.assign({minLimit:0,maxLimit:128,fftSize:1024,smoothing:.3},n),i._checkOptions(i.options),i._cache=null,i.source=null,i.analyser=i._initAnalyser(i.options),i}return s(e,f),o(e,[{key:"_checkOptions",value:function(t){if(t.maxLimit<=t.minLimit)throw new RangeError("Wrong limit range for volume")}},{key:"_initAnalyser",value:function(t){var e=this,n=this.context.createAnalyser();return n.fftSize=t.fftSize,n.smoothingTimeConstant=t.smoothing,this.mainbus.on("dataavailable",function(t){return e._processData()}),n}},{key:"pipe",value:function(t){this.source=this.context.createMediaStreamSource(t),this.source.connect(this.analyser)}},{key:"cutoff",value:function(){this.source.disconnect(this.analyser),this.source=null}},{key:"_processData",value:function(){this._cache||(this._cache=new Uint8Array(this.analyser.frequencyBinCount)),this.analyser.getByteFrequencyData(this._cache);var t=this._calcAvgVolume(this._cache);this.mainbus.emit("wave",{value:this._alignVolume(t)})}},{key:"_alignVolume",value:function(t){var e=this.options;return t<e.minLimit&&(t=e.minLimit),t>e.maxLimit&&(t=e.maxLimit),(t-e.minLimit)/(e.maxLimit-e.minLimit)}},{key:"_calcAvgVolume",value:function(t){for(var e=0,n=t.length,i=0;i<n;i++)e+=t[i];return e/n}}]),e}(),y=Object.prototype.hasOwnProperty,v=function(){function t(e){r(this,t),this.steps=e.split("."),this.fallback=void 0}return o(t,[{key:"travel",value:function(t,e){if("function"!=typeof e)throw new TypeError(e+" is not a function");for(var n=this.steps.length,i=0,r=this.steps[i];e(t,r)&&i<n;)t=t[r],r=this.steps[++i];return{step:i,value:t}}},{key:"or",value:function(t){return this.fallback=t,this}},{key:"from",value:function(t){var e=this.travel(t,function(t,e){return null!=t&&e in Object(t)});return e.step===this.steps.length?e.value:this.fallback}},{key:"hadBy",value:function(t){return this.travel(t,function(t,e){return null!=t&&e in Object(t)}).step===this.steps.length}},{key:"ownedBy",value:function(t){return this.travel(t,function(t,e){return null!=t&&y.call(t,e)}).step===this.steps.length}}]),t}(),d=function(e){function c(t){r(this,c);var e=a(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));return e.options=Object.assign({mimeType:"audio/webm",audioBitsPerSecond:96e3},t),e._intern=null,e._result=null,e._filter=new p(e,e.options.meter),e}return s(c,u),o(c,[{key:"open",value:function(){var e=this;return t(this.ready).that(i("open")).to.equal(!1),n().then(function(t){e._intern=new MediaRecorder(t,e.options);["error","pause","resume","start","stop"].map(function(t){e._intern.addEventListener(t,function(n){return e.emit(t,n)})}),e._intern.addEventListener("dataavailable",function(t){e._result.push(t.data),e.emit("dataavailable",t)}),e._filter.pipe(t)})}},{key:"close",value:function(){t(this.ready).that(i("close")).to.equal(!0);for(var e=this._intern.stream.getTracks(),n=0;n<e.length;n++)e[n].stop();this._filter.cutoff(),this._intern=null}},{key:"start",value:function(e){var n=this;t(this.state).that(i("start",this)).to.equal("inactive"),this._result=[],this.ready?this._intern.start(e):this.open().then(function(){n._intern.start(e)})}},{key:"stop",value:function(){t(this.state).that(i("stop",this)).to.not.equal("inactive"),this._intern.stop()}},{key:"pause",value:function(){t(this.state).that(i("pause",this)).to.equal("recording"),this._intern.pause()}},{key:"resume",value:function(){t(this.state).that(i("resume",this)).to.equal("paused"),this._intern.resume()}},{key:"state",get:function(){return null===this._intern?"inactive":this._intern.state}},{key:"ready",get:function(){return null!==this._intern}},{key:"result",get:function(){return this._result?new Blob(this._result,{type:this.options.mimeType}):null}}]),c}();return function(t){function e(){return r(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return s(e,d),e}()});
//# sourceMappingURL=wavebell.min.js.map